/**
 * jQuery nanameSlider plugin
 *
 * Version: 0.530
 * Copyright (c) 2017 Kaz Dohman
 * License: MIT
 * Demo: https://wotbu.com/dev/jquery/naname_slider/
 */
;(function(factory){if( typeof define === "function" && define.amd ){define(["jquery"], factory);}else if( typeof exports === "object" ){module.exports = factory(require("jquery"));}else{factory(jQuery);};}(function($){if(!$) {return console.warn('nanameSlider needs jQuery');}var plugin = {};var defaults = {skewYangle: -5,beforeSelector: '',afterSelector: '',slideDirection: 'left',autoPlay: false,autoPause: 3000,speed: 0.35,repeatMax: 10,pagerVisibility: true,pNbuttonVisibility: true,pNiconfontLclass: 'icon-chevron-left',pNiconfontRclass: 'icon-chevron-right',prevButtonTop: 0,nextButtonTop: 0,pagerTop: 10,wrapperClass: 'skewy-wrapper',touchEnabled: true,};$.fn.nanameSlider = function(options){if(this.length == 0){console.warn('No element');return this;}if(this.length > 1){this.each(function(){$(this).nanameSlider(options)});return this;}var slider = {};var el = this;plugin.el = this;var slideNum = 0;var ww = hh = 0;var skewH = 0;var childrenCou = 1;var next_childrenCou = 0;var translateYval = 0;var repeatCount = 1;var timerId = null;var heightMax = 0;var beforeAppend = '';var afterAppend = '';var nextButTop = 0;var touchDirection, touchPosition;var aPagerEl = $('<div class="skewy-pager" />');var init = function(){slider.settings = $.extend({}, defaults, options);slider.skewYangle = slider.settings.skewYangle;if (slider.skewYangle <= 0){slider.angleP = true;}else{slider.angleP = false;}slider.beforeSelector = slider.settings.beforeSelector;slider.afterSelector = slider.settings.afterSelector;slider.slideDirection = slider.settings.slideDirection;slider.autoPlay = slider.settings.autoPlay;slider.autoPause = slider.settings.autoPause;slider.speed = slider.settings.speed;slider.repeatMax = slider.settings.repeatMax;slider.pagerVisibility = slider.settings.pagerVisibility;slider.pNbuttonVisibility = slider.settings.pNbuttonVisibility;slider.pNiconfontLclass = slider.settings.pNiconfontLclass;slider.pNiconfontRclass = slider.settings.pNiconfontRclass;slider.prevButtonTop = parseInt(slider.settings.prevButtonTop);slider.nextButtonTop = parseInt(slider.settings.nextButtonTop);slider.pagerTop = parseInt(slider.settings.pagerTop);if(slider.slideDirection == 'right') {var reverseList = el.children().toArray().reverse();el.empty().append(reverseList);}slider.children = el.children();initSetup();};var initSetup = function(){if(slider.beforeSelector != '' && el.prev(slider.beforeSelector).length){beforeAppend = el.prev(slider.beforeSelector);beforeAppend.css({'display': 'none'});}if(slider.afterSelector != '' && el.next(slider.afterSelector).length) {afterAppend = el.next(slider.afterSelector);afterAppend.css({'display': 'none'});}el.wrap('<div class="' + slider.settings.wrapperClass + '"><div class="skewy-viewport"></div></div>');var sliceAppend = slider.children.slice(0, 1).clone().addClass('s-clone');var slicePrepend = slider.children.slice(-1).clone().addClass('s-clone');el.append(sliceAppend).prepend(slicePrepend);slider.children = el.children();slideNum = slider.children.size();next_childrenCou = slideNum-1;var getHeightMax = getViewportHeight();if (heightMax < (getHeightMax * slideNum)) {slider.children.children().css({'height': getHeightMax+'px'});}slider.children.css({'display': 'none'});if (slider.pNbuttonVisibility) {slider.prevArrow = $('<a href="" class="skewy-prev"><span class="' + slider.pNiconfontLclass +'"></span></a>');slider.nextArrow = $('<a href="" class="skewy-next"><span class="' + slider.pNiconfontRclass +'"></span></a>');slider.prevArrow.on('click', clickPrevBind);slider.nextArrow.on('click', clickNextBind);el.before(slider.prevArrow);el.after(slider.nextArrow);slider.prevArrow.css({'visibility': 'hidden'});slider.nextArrow.css({'visibility': 'hidden'});}if (slider.pagerVisibility){var pagerHtml = '';for(var i=0; i < (slideNum-2); i++){var linkContent = '';linkContent = i + 1;pagerHtml += '<div class="skewy-pager-item"><a href="" data-slide-index="' + i + '" class="skewy-pager-link">' + linkContent + '</a></div>';}aPagerEl.html(pagerHtml);aPagerEl.css({'visibility': 'hidden'});el.closest('.skewy-viewport').after(aPagerEl);el.closest('.skewy-wrapper').find('a.skewy-pager-link').on('click', function(e) {if (slider.autoPlay && timerId !== null) clearInterval(timerId);clickPagerBind(e);});var clickPagerBind = function(e){var pagerLink = $(e.currentTarget);var pagerTx = pagerLink.text();if(pagerTx !== undefined){var pagerIndex = parseInt(pagerTx);if ( ! pagerLink.hasClass('active') ) {if ( pagerIndex > childrenCou ) {childrenCou = pagerIndex-1;if (slider.angleP){translateYval = skewH* childrenCou;}else{translateYval = skewH* childrenCou*-1;}clickNextBind(e);} else{childrenCou = pagerIndex+1;if (slider.angleP){translateYval = skewH* childrenCou;}else{translateYval = skewH* childrenCou*-1;}clickPrevBind(e);}}}e.preventDefault();}}else if(afterAppend != ''){el.closest('.skewy-viewport').after(aPagerEl);}};var slideSetup = function(){ww = el.parent().width();hh = slider.children.height();var r = Math.abs(slider.skewYangle) * Math.PI / 180;skewH = Math.round(ww * Math.tan (r));if (slider.angleP){translateYval = skewH;}else{translateYval = skewH*-1;}el.closest('.skewy-viewport').css({'padding-bottom': skewH+'px', 'overflow': 'hidden'});if(slider.slideDirection == 'left') {el.css({'width': ww * slideNum +'px', 'transform':'translate3d(-'+ ww +'px, ' + translateYval + 'px, 0px) skewY('+ slider.skewYangle +'deg)'});}else if(slider.slideDirection == 'right') {childrenCou = slideNum-2;if (slider.angleP){translateYval = skewH * childrenCou;}else{translateYval = (skewH * childrenCou)*-1;}el.css({'width': ww * slideNum +'px', 'transform':'translate3d(-'+ (ww * childrenCou) +'px, ' + translateYval + 'px, 0px) skewY('+ slider.skewYangle +'deg)'});}if (slider.angleP){el.css({'top': skewH + 'px'});}else{el.css({'top': '0px'});}slider.children.css({'width': ww +'px'});el.find('.s-clone').css({'width': ww +'px'});if (slider.pNbuttonVisibility) {slider.prevArrow.css({'visibility': 'visible'});slider.nextArrow.css({'visibility': 'visible'});var prevButH = el.closest('.skewy-viewport').find('.skewy-prev').height();nextButTop = (hh/2)-(prevButH/2);}if(beforeAppend != '' ) {$(beforeAppend).insertBefore(slider.prevArrow);if (slider.angleP){if (slider.pNbuttonVisibility) {beforeAppend.css({'transform': 'skewY('+ slider.skewYangle +'deg)', 'top': skewH+'px'});}else{beforeAppend.css({'transform': 'skewY('+ slider.skewYangle +'deg)', 'top': (skewH-beforeAppend.outerHeight(true))+'px'});}if(Math.abs(slider.skewYangle) > 0){var minWrapperMarginT = Math.min(skewH, beforeAppend.outerHeight(true));el.closest('.'+slider.settings.wrapperClass).css({'margin': '-'+minWrapperMarginT + 'px auto 0'});}}else{beforeAppend.css({'transform': 'skewY('+ slider.skewYangle +'deg)', 'top': '0px'});}if (slider.pNbuttonVisibility) nextButTop = nextButTop + beforeAppend.outerHeight(true);beforeAppend.css({'display': 'block'});}if(afterAppend != '' ) {$(afterAppend).appendTo(aPagerEl);afterAppend.css({'display': 'block'});}if (slider.pagerVisibility || afterAppend != ''){if (slider.pagerTop > 0){var paddingBot = skewH+aPagerEl.height()+slider.pagerTop;}else{var paddingBot = skewH+aPagerEl.height();}el.closest('.skewy-viewport').css({'padding-bottom': paddingBot +'px', 'overflow': 'hidden'});if (slider.pagerVisibility) {if(slider.slideDirection == 'left') {aPagerEl.children().find('a').eq(0).addClass('active');}else if(slider.slideDirection == 'right') {aPagerEl.children().find('a').eq(-1).addClass('active');}}aPagerEl.css({'visibility': 'visible', 'transform': 'skewY('+ slider.skewYangle +'deg)', 'margin-bottom': aPagerEl.height() + 'px'});}if (slider.angleP){if (slider.pNbuttonVisibility) {el.closest('.skewy-viewport').find('.skewy-next').css({'top': (nextButTop+slider.nextButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});el.closest('.skewy-viewport').find('.skewy-prev').css({'top': (nextButTop+ skewH+slider.prevButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});}if (!slider.pagerVisibility) {aPagerEl.css({'bottom': '-'+(aPagerEl.height()-slider.pagerTop)+'px'});}else{aPagerEl.css({'bottom': '-'+aPagerEl.height()+'px'});}}else{if (slider.pNbuttonVisibility) {el.closest('.skewy-viewport').find('.skewy-next').css({'top': (nextButTop+ skewH+slider.nextButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});el.closest('.skewy-viewport').find('.skewy-prev').css({'top': (nextButTop+slider.prevButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});}var aPagerEl_top = 0;if (!slider.pagerVisibility && slider.pagerTop > 0) slider.pagerTop = 0;if(beforeAppend != '' ){aPagerEl_top = hh+slider.pagerTop+beforeAppend.outerHeight(true);}else{aPagerEl_top = hh+slider.pagerTop;}aPagerEl.css({'top': aPagerEl_top +'px'});}};var initTouch = function(){el.on('touchstart', onTouchStart);};var onTouchStart = function(e){if (slider.autoPlay && timerId !== null) clearInterval(timerId);touchPosition = getTouchPosition(e);touchDirection = '';el.on('touchmove', onTouchMove);el.on('touchend', onTouchEnd);};var onTouchMove = function(e){if (touchPosition - getTouchPosition(e) > 50) {touchDirection = 'left';} else if (touchPosition - getTouchPosition(e) < -50) {touchDirection = 'right';}};var onTouchEnd = function(e){el.off('touchmove', onTouchMove);if (touchDirection == 'right'){if(slider.slideDirection == 'left') {gotoNextSlide(e);}else if(slider.slideDirection == 'right') {gotoPrevSlide(e);}} else if (touchDirection == 'left'){if(slider.slideDirection == 'left') {gotoPrevSlide(e);}else if(slider.slideDirection == 'right') {gotoNextSlide(e);}}el.off('touchend', onTouchEnd);};var getTouchPosition = function(e){return e.originalEvent.touches[0].pageX;};$(window).on('load', function(e){slideSetup();if (slider.settings.touchEnabled ) initTouch();$('img', slider.children).on('load', function() {height = $(this).height();});var hh2 = slider.children.height();if (hh2 != hh) {if (slider.pNbuttonVisibility) {var prevButH = el.closest('.skewy-viewport').find('.skewy-prev').height();nextButTop = (hh2/2)-(prevButH/2);}if (slider.angleP){if (slider.pNbuttonVisibility) {el.closest('.skewy-viewport').find('.skewy-next').css({'top': (nextButTop+slider.nextButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});el.closest('.skewy-viewport').find('.skewy-prev').css({'top': (nextButTop+ skewH+slider.prevButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});}}else{if (slider.pNbuttonVisibility) {el.closest('.skewy-viewport').find('.skewy-next').css({'top': (nextButTop+ skewH+slider.nextButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});el.closest('.skewy-viewport').find('.skewy-prev').css({'top': (nextButTop+slider.prevButtonTop) +'px','transform': 'skewY('+ slider.skewYangle +'deg)'});}if(beforeAppend != '' ){var aPagerEl_top = hh2+slider.pagerTop+beforeAppend.outerHeight(true);}else{var aPagerEl_top = hh2+slider.pagerTop;}aPagerEl.css({'top': aPagerEl_top +'px'});}}slider.children.css({'display': 'block'});if (slider.autoPlay) {timerId = setInterval(function(){if(slider.slideDirection == 'left') {gotoNextSlide(e);}else if(slider.slideDirection == 'right') {gotoPrevSlide(e);}if(slider.repeatMax > 0){if(repeatCount >= slider.repeatMax){clearInterval(timerId);}repeatCount ++;}}, slider.autoPause);}});$(window).on('resize', function(){if (slider.autoPlay && timerId !== null) clearInterval(timerId);if(slider.slideDirection == 'left') {childrenCou = 1;}else if(slider.slideDirection == 'right') {childrenCou = slideNum-2;}slideSetup();});var clickNextBind = function(e){if (slider.autoPlay && timerId !== null) clearInterval(timerId);gotoNextSlide(e);};var gotoNextSlide = function(e){childrenCou ++;position = slider.children.eq(childrenCou).position();if (slider.angleP){translateYval += skewH;}else{translateYval -= skewH;}var newTY = translateYval;next_childrenCou = childrenCou;el.css({'transform':'translate3d(-'+ position.left +'px, ' + newTY + 'px, 0px) skewY('+ slider.skewYangle +'deg)','transition-duration': slider.speed + 's'}).on('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(){if (childrenCou == (slideNum-1)) {childrenCou = 1;position = slider.children.eq(childrenCou).position();if (slider.angleP){translateYval = skewH;}else{translateYval = skewH*-1;}el.css({'transform':'translate3d(-'+ position.left +'px, ' + translateYval + 'px, 0px) skewY('+ slider.skewYangle +'deg)','transition-duration': '0s'});}if (slider.pagerVisibility) {aPagerEl.children().find('a').removeClass('active');aPagerEl.children().find('a').eq((childrenCou-1)).addClass('active');}});e.preventDefault();};var clickPrevBind = function(e){if (slider.autoPlay && timerId !== null) clearInterval(timerId);gotoPrevSlide(e);};var gotoPrevSlide = function(e){childrenCou --;position = slider.children.eq(childrenCou).position();if (slider.angleP){translateYval -= skewH;}else{translateYval += skewH;}var newTY = translateYval;el.css({'transform':'translate3d(-'+ position.left +'px, ' + newTY + 'px, 0px) skewY('+ slider.skewYangle +'deg)','transition-duration': slider.speed + 's'}).on('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(){if (childrenCou == 0) {childrenCou = slideNum-2;position = slider.children.eq(childrenCou).position();if (slider.angleP){translateYval = skewH * (slideNum-2);}else{translateYval = (skewH * (slideNum-2))*-1;}el.css({'transform':'translate3d(-'+ position.left +'px, ' + translateYval + 'px, 0px) skewY('+ slider.skewYangle +'deg)','transition-duration': '0s'});}if (slider.pagerVisibility) {aPagerEl.children().find('a').removeClass('active');aPagerEl.children().find('a').eq((childrenCou-1)).addClass('active');}});e.preventDefault();};var getViewportHeight = function(){var height = 0;height = Math.max.apply(Math, slider.children.map(function(){heightMax += $(this).outerHeight(false);return $(this).outerHeight(false);}).get());return height;};init();return this;};}));